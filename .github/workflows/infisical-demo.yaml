name: Infisical OIDC Secrets Demo

on:
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  demo:
    runs-on: ubuntu-latest

    steps:
      - name: Authenticate with Infisical via OIDC and fetch secrets
        uses: Infisical/secrets-action@v1.0.9
        with:
          method: oidc
          identity-id: "6a258e70-d08b-48bb-8de5-0f3939c9fd30"
          domain: "https://app.infisical.com"
          project-slug: "github-actions-infisical-63-hs"
          env-slug: "dev"

      - name: Use DATABASE_URL secret
        run: |
          echo "DATABASE_URL is set"
          echo "Extracted host:"
          echo "$DATABASE_URL" | sed -E 's|.*@([^:/]+).*|\1|'
